cache:
  key: "$CI_BUILD_REF_NAME"
  paths:
    - public/app.css
    - public/app.js
    - public/vendor.js

stages:
  - build
  - deploy

build:
  stage: build

  cache:
    paths:
      - node_modules/
  script:
    - npm install
    - npm list --depth=0
    - npm run build:prod

deploy:
  stage: deploy

  only:
    - master
  script:
    - >-
      rsync
      --archive
      --compress
      --delete
      --itemize-changes
      --no-group
      --no-owner
      --relative
      -e ssh
      public/app.css
      public/app.js
      public/vendor.js
      www@gailkirklandphotography.com:/var/www/gailkirklandphotography-www
